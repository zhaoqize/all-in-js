## 长连接

数据传输完成了保持TCP连接不断开（不发RST包、不四次握手），等待在同域名下继续用这个通道传输数据；相反的就是短连接。

> HTTP1.1中默认启用了长连接
> 
> 表现形式：Connection: Keep-alive

### 改变

Nginx、Apache中可以设置

### 长连接的优点

省去较多的TCP建立和关闭的操作，减少浪费，节约时间

> 优化：
> - 通过长连接超时时间的设定等操作，关闭不用的连接，避免浪费
> - 限制每个客户端的最大长连接数

### 长连接数据数据传输完成识别

既然是长连接，也就是连接不关闭。那怎么知道数据是否传输完毕呢？

- 1、是判断传输数据是否达到了Content-Length指示的大小
- 2、动态生成的文件没有Content-Length，它是分块传输（chunked），这时候就要根据chunked编码来判断，chunked编码的数据在最后有一个空chunked块，表明本次传输数据结束
